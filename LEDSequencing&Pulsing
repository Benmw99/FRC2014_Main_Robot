    //*****************************************************************************/
    //*****************************************************************************/
    // Title: Arduino LED Synchronization Breathing and Pulsation Code
    // Author: Brandon Spirito
    // Date: 2/18/2014
    // Revision: 1
    //
    // Description: This code uses LPD8806-based RGB LED Modules in a strip with a main 
    // objective to provides the driver, shooter, and other team members/friendlies 
    // with visual cues to easily identify articulation movements and other various 
    // components on our 2168 competition robot.
    //
    //
    // 
    //*****************************************************************************/
    //*****************************************************************************/
    
    #include "LPD8806.h"
    #include "SPI.h"
    
    
    // Two LED strips with 8 LEDs per each strip located on the Intake Arm at the rear 
    // of the robot.
    //**These LED strips will be used to tell the driver when the Intake arm is down and 
    // ready to receive a ball.
    //**They will also be used to tell the driver when the intake arm is up.
    
    // Generic Bold Colors for reference:
    // strip.setPixelColor(q, strip.Color(127, 127, 127)); // White
    // strip.setPixelColor(q, strip.Color(127,   0,   0)); // Red
    // strip.setPixelColor(q, strip.Color(127, 127,   0)); // Yellow
    // strip.setPixelColor(q, strip.Color(  0, 127,   0)); // Green
    // strip.setPixelColor(q, strip.Color(  0, 127, 127)); // Cyan
    // strip.setPixelColor(q, strip.Color(  0,   0, 127)); // Blue
    // strip.setPixelColor(q, strip.Color(127,   0, 127)); // Violet 
    
    // Number of LEDs in a strand on both sides of intake arm.
    // Note* there will be two of these wired in parallel to give a ball feed look.
    int IntakeStripLength = 8;    //   [>> >> >> >>] && [<< << << <<]
   
    // Choose 2 pins for output; Can be any valid output pins:
    int dataPin = 2;   
    int clockPin = 3;

    // First parameter is the number of LEDs in the strand.
    // Next two parameters are SPI data and clock pins.
    LPD8806 strip = LPD8806(IntakeStripLength, dataPin, clockPin);
    
    // Initalize Colors
    int targetR = 0,
        targetG = 0,
        targetB = 0,
        R_OUT = 0,
        G_OUT = 0,
        B_OUT = 0;        
   
    
    //*****************************************************************************/
    // Breathe Table - Brightness and Fading Time Cycle
    //*****************************************************************************/
    uint8_t LED_Breathe_Table[]  = 
    {  202, 211, 220, 228, 236, 242, 247, 251, 254, 255, 255, 254, 251, 247, 242, 236,
       228, 220, 211, 202, 192, 182, 172, 161, 151, 141, 131, 121, 112, 103,  95,  87,  
       80,  73,  66, 60,  55,  50,  45,  41,  38,  34,  31,  28,  26,  24,  22,  20,  
       20,  20,  20, 20,  20,  20,  20,  20,  20   };

    #define BREATHE_TABLE_SIZE (sizeof(LED_Breathe_Table))
    #define BREATHE_CYCLE    700   /*breathe cycle in milliseconds*/
    #define BREATHE_UPDATE    (BREATHE_CYCLE / BREATHE_TABLE_SIZE)
    
    //*****************************************************************************/
    
    void setup() {
      // Start up the LED strip
      strip.begin();
     
      // Turn on LEDs (check integrity using all colors - i.e. rainbow)
      for(int q = 0; q < strip.numPixels(); q++) {
      strip.setPixelColor(i, Wheel( ((i * 384 / strip.numPixels()) + j) % 384) );  
      //strip.setPixelColor(q, strip.Color(0,127,0));
      }
      
      strip.show();
      delay(1000);

      // Turn off LEDs (clearing the colors)
      for(int q = 0; q < strip.numPixels(); q++) {
        strip.setPixelColor(q, strip.Color(0,0,0));
      }
      strip.show();  

    void loop() {
      int cycle;
      // LED pulsation
      for (cycle=0; cycle < 1; cycle++) {
        uniformBreathe(LED_Breathe_Table, BREATHE_TABLE_SIZE, BREATHE_UPDATE, 2, 2, 200);
      }
      
      // LED shifting 
      for (cycle=0; cycle < 2; cycle++) {     // 200, 2, 20
        sequencedBreathe(LED_Breathe_Table, BREATHE_TABLE_SIZE, BREATHE_UPDATE, 160, 2, 170);
      }
    }
    // Makes it go through the cycle fairly fast.
    rainbowCycle(0); 
   
   //*****************************************************************************/
   // Rainbow wheel - equal distribution along chain
   //*****************************************************************************/
   void rainbowCycle(uint8_t wait) {
     uint16_t i, j;
          
     for (j=0; j < 384 * 5; j++) {     // 5 cycles of all 384 colors in the wheel
       for (i=0; i < strip.numPixels(); i++) {
         // tricky math! we use each pixel as a fraction of the full 384-color wheel
         // (thats the i / strip.numPixels() part)
         // Then add in j which makes the colors go around per pixel
         // the % 384 is to make the wheel cycle around
         strip.setPixelColor(i, Wheel( ((i * 384 / strip.numPixels()) + j) % 384) );
       }  
       strip.show();   // write all the pixels out
       delay(wait);
     }
   }
   
   //*****************************************************************************/
   // Pulsation and Sequencing 
   //*****************************************************************************/
    void uniformBreathe(uint8_t* breatheTable, uint8_t breatheTableSize, uint16_t updatePeriod, uint16_t r, uint16_t g, uint16_t b)
    {
      int i;
      uint8_t breatheIndex = 0;
      uint8_t breatheRed;
      uint8_t breatheGrn;
      uint8_t breatheBlu;
     
      for (breatheIndex = 0; breatheIndex < breatheTableSize; breatheIndex++) {
        for (i=0; i < strip.numPixels(); i++) {
          breatheRed = (r * breatheTable[breatheIndex]) / 256;
          breatheGrn = (g * breatheTable[breatheIndex]) / 256;
          breatheBlu = (b * breatheTable[breatheIndex]) / 256;
          strip.setPixelColor(i, breatheRed, breatheGrn, breatheBlu);
        }
        strip.show();   // write all the pixels out
        delay(updatePeriod);
      }
    }

    void sequencedBreathe(uint8_t* breatheTable, uint8_t breatheTableSize, uint16_t updatePeriod, uint16_t r, uint16_t g, uint16_t b)
    {
      int i;
      uint8_t breatheIndex = 0;
      uint8_t breatheRed;
      uint8_t breatheGrn;
      uint8_t breatheBlu;
      uint8_t sequenceIndex;
     
      for (breatheIndex = 0; breatheIndex < breatheTableSize; breatheIndex++) {
        for (i=0; i < strip.numPixels(); i++) {
          sequenceIndex = (breatheIndex + (i*4)) % breatheTableSize;
          breatheRed = (r * breatheTable[sequenceIndex]) / 256;
          breatheGrn = (g * breatheTable[sequenceIndex]) / 256;
          breatheBlu = (b * breatheTable[sequenceIndex]) / 256;
          strip.setPixelColor(i, breatheRed, breatheGrn, breatheBlu);
        }
        strip.show();   // write all the pixels out
        delay(updatePeriod);
      }
    }
    //*****************************************************************************/
